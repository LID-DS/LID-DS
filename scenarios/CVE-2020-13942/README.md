# CVE-2020-13942: Injection Vulnerabilty in Apache Unomi leads to Remote Code Execution

## Description / Overview of scenario
In Apache Unomi Version 1.5.0 an injection vulnerability exists that allows the execution of remote Code via OGNL and MVEL scripts. It was partially fixed in Version 1.5.1 but a new attack vector was found. This scenario uses Version 1.5.1 and supports the two different script types MVEL and OGNL.

## victim:
The victim runs Elasticsearch 7.4.2 and Apache Unomi 1.5.1 in a docker container. It serves all of the default API Endpoints and is capable of authenticated HTTP requests. Because of running both Elasticsearch and Unomi in the same container the startup time of the victim is a bit longer than for other scenarios (approx. 30s).

## normal:
The exploit sends both POST and GET requests, each with a 50 % chance. It randomly selects from a list of API endpoints and POSTS randomly created data. 

## exploit:
The exploit is implemented configurable with the two attack script versions MVEL and OGNL. This can be triggered using a fourth argument by typing ognl or mvel. Both exploits use the remote code execution vulnerability in unomi to create files in the /tmp/ directory of the host system. The original exploit POC is linked below and was rewritten as python requests.


#### Further information:
* CVE entry: https://cve.mitre.org/cgi-bin/cvename.cgi?name=2020-13942
* POC: https://github.com/vulhub/vulhub/tree/master/unomi/CVE-2020-13942
* Product Website: https://unomi.apache.org/
* OGNL: https://commons.apache.org/proper/commons-ognl/
* MVEL: https://camel.apache.org/components/3.4.x/languages/mvel-language.html

## cli:

    sudo python3 main.py a b c d
    
    a: boolean (0/1) run automated normal behavior
    b: integer recording time
       1-n: recording time in seconds
        -1: flag to run auto stop of recording after end of exploit
    c: boolean (0/1) run automated exploit
    d: string attack type (ognl/mvel) only needed when param c is True