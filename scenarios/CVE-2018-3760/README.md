# CVE-2018-3760: Path Traversal Vulnerabilty in Sprockets leads to extraction of out of scope root files like /etc/passwd

## Description / Overview of scenario
There is an information leak vulnerability in the Sprockets asset serving system. Versions Affected: 4.0.0.beta7 and lower, 3.7.1 and lower, 2.12.4 and lower. Specially crafted requests can be used to access files that exists on the filesystem that is outside an application's root directory, when the Sprockets server is used in production.

## victim:
The victim builds on a rails 5.0.7 image from vulhub. It contains a simple web app that includes a movie list with basic CREATE, READ, UPDATE and DELETE functionality on an attached mysql database.

## normal:
The normal behaviour is built as a selenium auto clicker that in the first step opens the website, iterates through available links and picks and clicks one randomly. When detecting forms for the movie list it creates random data and performs random CRUD statements to simulate sensible user behaviour.

## exploit:
The exploit happens in two steps:
1. a GET statement is executed trying to extract the file /etc/password directly - this leads to a error message that contains allowed folders.
2. another GET statement with a path based on one selected allowed folder is executed. `/%252e%252e/` is used to climb up the path and finally navigate to /etc/passwd.

Further information:
* https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-3760
* https://github.com/cyberharsh/Ruby-On-Rails-Path-Traversal-Vulnerability-CVE-2018-3760-/blob/master/README.md

## cli:

    sudo python3 main.py a b c
    
    a: boolean (0/1) run automated normal behavior
    b: integer recording time
       1-n: recording time in seconds
        -1: flag to run auto stop of recording after end of exploit
    c: boolean (0/1) run automated exploit