import sys
import time
import argparse
from random import randint
from selenium import webdriver
from pyvirtualdisplay import Display
from selenium.webdriver.chrome.options import Options


def visitSite(driver, site: str):
    link = f"http://{args.server_ip}:3000/{site}"
    driver.get(link)
    if args.verbose:
        print(f"visited: {link}")
    return 1


def randomWalk(driver, sites):
    while True:
        sys.stdin.readline()
        try:
            # choose site
            which_site = randint(0, len(sites) - 1)
            # 50/50 if going to site
            visitSite(driver,
                      sites[which_site])
        except Exception as e:
            if args.verbose:
                print(e)


if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='HTTPS-Client Simulation.')

    parser.add_argument('-ip',
                        dest='server_ip',
                        action='store',
                        type=str,
                        required=True,
                        help='The IP address of the target server')
    parser.add_argument('-v',
                        dest='verbose',
                        action='store',
                        type=bool,
                        required=False,
                        default=False,
                        help='Make the operations more talkative')

    args = parser.parse_args()

    sites = [
        'chybeta',
        'site1',
        'site2',
        'site3',
        'site4',
        'site5',
    ]

    # Disable requests warnings (caused by self signed server certificate)
    # requests.packages.urllib3.disable_warnings()

    # Virtual display to run chrome-browser
    display = Display(visible=0, size=(800, 800))
    display.start()

    # Headless chrome-browser settings
    chrome_options = Options()
    chrome_options.add_argument("--no-sandbox")
    chrome_options.add_argument('--ignore-certificate-errors')
    driver = webdriver.Chrome(chrome_options=chrome_options)

    randomWalk(driver, sites)
